<!DOCTYPE html>
<html>

<head>
    <title>The Gateway</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/style.css">
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Google+Sans:ital,opsz,wght@0,17..18,400..700;1,17..18,400..700&display=swap');

html {
    font-size: 12px;
    height: 100%;
}

body {
    background: #f8f8f8;
    font-family: "Google Sans", sans-serif;
    font-size: 1rem;
    line-height: 1.8rem;
    height: 100%;
    display: flex;
    flex-direction: column;
    margin: 0;
    padding: 0;
}

main {
    height: 100%;

    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.container {
    width: 88%;
    margin: auto;

}

.row {
    display: flex;
    gap: 1rem;
}

.breadcrumb {
    display: flex;
    flex-direction: row;
    align-items: center;
}

.head {
    display: flex;
    flex-grow: 1;
    justify-content: space-between;
    background: #003978;
    border-radius: 8px;
    color: #fff;
    padding: 1.4rem;
    margin-top: 1rem;

}

.hero {
    margin-top: 2rem;
    padding: 1.4rem;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    /* box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, .5);
}

.insights {
    margin-top: 2rem;
    margin-bottom: 2rem;
    padding: 1.4rem;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    /* box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, .5);
}

.card {
    display: flex;
    flex-grow: 1;
    margin-top: 2rem;
    padding: 1.4rem;
    background: #EEF7FB;
    border-radius: 4px;
    /* box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    color: #69778C;
}

.breadcrumb ul {
    display: flex;
    flex-direction: row;
    align-items: center;
    list-style: none;
    gap: 1rem;
    padding: .5rem 2rem;
}

.breadcrumb ul li {
    display: flex;
    flex-direction: row;
    align-items: center;
    list-style: none;
}

.breadcrumb ul>li>a {
    display: flex;
    flex-direction: row;
    align-items: center;
    list-style: none;
    color: #69778C;
    text-decoration: none;
}

a {
    color: #f2ebc4;
    text-decoration: none;
}

h1 {
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 0px;
    padding-top: 0px;
}

h2 {
    font-weight: 400;
    margin-top: 0px;
    margin-bottom: 0px;
    padding-bottom: 0px;
    padding-top: 0px;
}

p {
    color: #69778C;
    margin-top: 0px;
    margin-bottom: 0px;
    padding-bottom: 0px;
    padding-top: 0px;
}

.btn {

    padding: .5rem 2rem;
    border-radius: 3rem;
    display: inline-block;
}

.btn-primary {
    background: #003978;
    margin-top: 2rem;
    margin-right: 1rem;
}

.btn-secondary {
    background: #0EA4DF;
    margin-top: 2rem;
    margin-right: 1rem;
}

.btn-link {
    color: #69778C;
}

.tag {
    padding: .25rem 1rem;
    border-radius: 3rem;
    display: inline-block;
}

#status {
    display: inline-block;
}

.tag {
    background: #eaeaea;
    color: #666;
    display: flex;
    align-items: center;
}

.tag.success {
    background: #8ce3d0;
    color: #066b55;
    display: flex;
    align-items: center;
}

.tag.failure {
    background: #e38ca9;
    color: #6b0624;
    display: flex;
    align-items: center;
}

#dot {
    background: #666;

}

#dot.success {
    background: #066b55;


}

#dot.failure {
    background: #6b0624;


}

/* RESET */




.stat {
    font-size: 1.2em;
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.value {
    font-weight: bold;
    color: #fff;
    background: #69778C;
    padding: 1rem;
    border-radius: 8px;
    height: 1rem;

    display: flex;
    justify-content: center;
    flex-direction: column;
}

.status-dot {
    height: 10px;
    width: 10px;
    background-color: #69778C;
    border-radius: 50%;
    display: inline-block;
    margin-right: 5px;
}
    </style>
</head>

<body>
    <header>
        <div class="container">
            <div class="head">
                <div class="logo"><a href="./index.html" class="logo">Gateway</a></div>
                <div class="main-menu">Home</div>
                <div class="settings"><a href="#" class="settings">Settings</a></div>
            </div>
        </div>
    </header>
    <section>
        <div class="container">
            <div class="breadcrumb">
                <a href="#" class="btn btn-link">Back</a>
                <ul class="">
                    <li><a href="#">Projects</a></li>
                    <li><a href="#">RAG System</a></li>

                </ul>
            </div>
            <di id="status">
                <a href="#" class="tag "><span id="dot" class="status-dot"></span> <span id="status-text">Connecting...</span></a>
            </di>
            <h3>Project name RAG system</h3>
        </div>
    </section>

    <main>
        
        <div class="stage">
            <div class="container">stage</div>
        </div>


        <div class="insights">
            <div class="container">
                <strong>Insights summary</strong>
                <div class="row">
                    <div class="card stat">
                        User Requests:<span id="req" class="value">0</span>
                    </div>
                    <div class="card stat">
                        LLM Responses:<span id="res" class="value">0</span>
                    </div>
                    <div class="card stat">
                        Total Errors:<span id="err" class="value"  >0</span>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="static/script.js"></script>
    <script src="{{ url_for('static', path='script.js') }}"></script>
    <script>
                    // Dynamic WebSocket URL generation
            const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
            
            // Ensure path ends with / so it matches the Python route logic
            let path = window.location.pathname;
            if (!path.endsWith('/')) path += '/';
            
            // Build the full WebSocket URL
            const wsUrl = `${protocol}://${window.location.host}${path}`;
            console.log("Connecting to Dashboard WS:", wsUrl);

            const ws = new WebSocket(wsUrl);
            const dot = document.getElementById("dot");
            const statusText = document.getElementById("status-text");
            const statusContainer = document.getElementByClass("tag");

            ws.onopen = () => {
                
                dot.classList.remove("failure");
                dot.classList.add("success");
                statusContainer.classList.remove("failure");
                statusContainer.classList.add("success");
                // dot.style.backgroundColor = "#00ff00";
                statusText.innerText = "Live Connected";
                // Keep-alive ping
                setInterval(() => { if(ws.readyState===1) ws.send("ping"); }, 2000);
            };

            ws.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    if(data.requests_from_user !== undefined) {
                        document.getElementById("req").innerText = data.requests_from_user;
                        document.getElementById("res").innerText = data.responses_from_llm;
                        document.getElementById("err").innerText = data.errors;
                        document.getElementById("last_p").innerText = data.last_prompt;
                    }
                } catch(e) { 
                    // Ignore non-JSON messages (like ping responses)
                }
            };

            ws.onclose = () => {
                dot.classList.remove("success");
                dot.classList.add("failure");
                statusContainer.classList.remove("success");
                statusContainer.classList.add("failure");
                // dot.style.backgroundColor = "red";
                statusText.innerText = "Disconnected";
            };
    </script>
</body>

</html>